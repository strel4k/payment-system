@startuml Payment System - C4 Context Diagram

!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

LAYOUT_WITH_LEGEND()

title System Context Diagram for Payment System

Person(customer, "Customer", "Individual user who manages their wallet and makes payments")

System_Boundary(payment_system, "Payment System") {
    System(individuals_api, "Individuals API", "Orchestrator: handles user registration, authentication, wallet and transaction operations (Port 8081)")
    System(person_service, "Person Service", "Manages personal data, user profiles with full audit history (Port 8082)")
    System(transaction_service, "Transaction Service", "Processes payments, manages wallets and transactions with two-phase commit (Port 8083)")
}

System_Ext(keycloak, "Keycloak", "Identity and Access Management, OAuth2/JWT (Port 8080)")
System_Ext(kafka, "Apache Kafka", "Message broker for async transaction events (Port 9092)")
System_Ext(nexus, "Nexus OSS", "Maven artifact repository â€” hosts person-service-api-client and transaction-service-api-client (Port 8091)")

System_Ext(prometheus, "Prometheus", "Metrics collection (Port 9090)")
System_Ext(grafana, "Grafana", "Observability dashboards: metrics, logs, traces (Port 3000)")
System_Ext(loki, "Grafana Loki", "Centralized log aggregation (Port 3100)")
System_Ext(tempo, "Grafana Tempo", "Distributed tracing backend (Port 3200)")

Rel(customer, individuals_api, "Uses", "HTTPS/REST")
Rel(individuals_api, person_service, "Manages person data", "HTTP/REST")
Rel(individuals_api, transaction_service, "Manages wallets & transactions", "HTTP/REST")
Rel(individuals_api, keycloak, "Authenticates users, obtains tokens", "HTTPS/Admin API")

Rel(transaction_service, kafka, "Publishes & consumes events", "deposit-requested/completed, withdrawal-requested/completed/failed")

Rel(individuals_api, nexus, "Resolves API client artifacts", "Maven/Gradle")

Rel(individuals_api, tempo, "Sends traces", "OTLP/HTTP")
Rel(person_service, tempo, "Sends traces", "OTLP/HTTP")
Rel(transaction_service, tempo, "Sends traces", "OTLP/HTTP")

Rel(prometheus, individuals_api, "Scrapes metrics", "HTTP")
Rel(prometheus, person_service, "Scrapes metrics", "HTTP")
Rel(prometheus, transaction_service, "Scrapes metrics", "HTTP")

Rel(grafana, prometheus, "Queries metrics", "PromQL")
Rel(grafana, loki, "Queries logs", "LogQL")
Rel(grafana, tempo, "Queries traces", "TraceQL")
Rel(customer, grafana, "Views dashboards", "HTTPS")

@enduml
