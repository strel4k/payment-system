# Test Coverage Report ‚Äî Payment System

---

## üìä Executive Summary

| –ú–æ–¥—É–ª—å | –¢–µ—Å—Ç–æ–≤ | JaCoCo (overall) | JaCoCo threshold |
|--------|--------|------------------|------------------|
| **person-service** | 33 | ~62% | 35% |
| **individuals-api** | 17 | ~21% | 20% |
| **transaction-service** | 38 | ~20%+ | 20% |
| **–ò—Ç–æ–≥–æ** | **88** | ‚Äî | ‚Äî |

> Overall % –Ω–∏–∑–∫–∏–π –∏–∑-–∑–∞ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö OpenAPI DTO –∏ entity –∫–ª–∞—Å—Å–æ–≤.
> –ü–æ–∫—Ä—ã—Ç–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ (–ø–æ—Å–ª–µ exclusions): **~80-90%** –ø–æ –≤—Å–µ–º –º–æ–¥—É–ª—è–º.

---

## üéØ person-service ‚Äî 33 —Ç–µ—Å—Ç–∞

### –¢–µ—Å—Ç-–∫–ª–∞—Å—Å—ã

| –ö–ª–∞—Å—Å | –¢–µ—Å—Ç–æ–≤ | –¢–∏–ø |
|-------|--------|-----|
| `PersonApplicationServiceTest` | 16 | Unit |
| `PersonsApiIT` | 11 | Integration (TestContainers) |
| `PersonMapperTest` | 6 | Unit |

### –ü–æ–∫—Ä—ã—Ç—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚úÖ **PersonApplicationService** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ, –ø–æ–ª—É—á–µ–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ Person  
‚úÖ **PersonMapper** ‚Äî –º–∞–ø–ø–∏–Ω–≥ CreatePersonRequest ‚Üî Entity ‚Üî PersonResponse  
‚úÖ **PersonsApiIT** ‚Äî E2E —á–µ—Ä–µ–∑ REST API, –≤–∞–ª–∏–¥–∞—Ü–∏—è, error handling (404, 400)

### –ò—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ JaCoCo
- Entity –∫–ª–∞—Å—Å—ã (`UserEntity`, `IndividualEntity`, `AddressEntity`, `CountryEntity`) ‚Äî –Ω–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- DTO –∫–ª–∞—Å—Å—ã ‚Äî –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã openapi-generator
- `GlobalExceptionHandler` ‚Äî ~39% coverage (–ø–æ–∫—Ä—ã–≤–∞–µ—Ç—Å—è E2E)
- Configuration –∫–ª–∞—Å—Å—ã

### JaCoCo threshold
```
overall:  35%  minimum
per-class: 30% minimum (—Å exclusions)
```

---

## üéØ individuals-api ‚Äî 17 —Ç–µ—Å—Ç–æ–≤

### –¢–µ—Å—Ç-–∫–ª–∞—Å—Å—ã

| –ö–ª–∞—Å—Å | –¢–µ—Å—Ç–æ–≤ | –¢–∏–ø |
|-------|--------|-----|
| `UserServiceTest` | 6 | Unit |
| `AuthControllerTest` | 4 | Unit (WebTestClient) |
| `AuthFlowIntegrationTest` | 4 | Integration (–ºoki) |
| `TokenServiceTest` | 2 | Unit |
| `IndividualsApiApplicationTests` | 1 | Context load |

### –ü–æ–∫—Ä—ã—Ç—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚úÖ **UserService** ‚Äî –ø–æ–ª–Ω—ã–π flow —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: Person ‚Üí Keycloak ‚Üí JWT  
‚úÖ **TokenService** ‚Äî refresh token validation –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ  
‚úÖ **AuthController** ‚Äî –≤—Å–µ 4 endpoints: registration, login, refresh-token, me  
‚úÖ **AuthFlowIntegrationTest** ‚Äî E2E —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å –ºo–∫–∞–º–∏ PersonService –∏ Keycloak

### –ò—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ JaCoCo
- OpenAPI generated code (`ApiClient`, `RFC3339DateFormat`, `ServerConfiguration`, `auth/*`) ‚Äî ~60% –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã
- `PersonServiceClient`, `TransactionServiceClient` ‚Äî HTTP –∫–ª–∏–µ–Ω—Ç—ã, –ø–æ–∫—Ä—ã–≤–∞—é—Ç—Å—è E2E
- `KeycloakClient` ‚Äî ~47% coverage —á–µ—Ä–µ–∑ integration tests
- `GlobalExceptionHandler` ‚Äî ~7% coverage
- Configuration –∏ Properties –∫–ª–∞—Å—Å—ã

### JaCoCo threshold
```
overall:  20% minimum (–º–Ω–æ–≥–æ autogenerated –∫–æ–¥–∞)
per-class: 20% minimum (—Å exclusions)
```

---

## üéØ transaction-service ‚Äî 38 —Ç–µ—Å—Ç–æ–≤

### –¢–µ—Å—Ç-–∫–ª–∞—Å—Å—ã

| –ö–ª–∞—Å—Å | –¢–µ—Å—Ç–æ–≤ | –¢–∏–ø |
|-------|--------|-----|
| `InitRequestCacheTest` | 12 | Unit |
| `FeeCalculatorTest` | 9 | Unit |
| `WalletServiceTest` | 9 | Unit |
| `TransactionServiceIntegrationTest` | 5 | Integration (TestContainers) |
| `TransactionRollbackTest` | 3 | Integration (@Transactional) |

### –ü–æ–∫—Ä—ã—Ç—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚úÖ **InitRequestCache** ‚Äî TTL, —Ö—Ä–∞–Ω–µ–Ω–∏–µ, –∏—Å—Ç–µ—á–µ–Ω–∏–µ requestUid  
‚úÖ **FeeCalculator** ‚Äî —Ä–∞—Å—á—ë—Ç –∫–æ–º–∏—Å—Å–∏–∏ –¥–ª—è deposit (0%), withdrawal (1%), transfer (0.5%)  
‚úÖ **WalletService** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞, –ø–æ–ª—É—á–µ–Ω–∏–µ, –≤–∞–ª–∏–¥–∞—Ü–∏—è  
‚úÖ **TransactionServiceIntegrationTest** ‚Äî deposit init/confirm, insufficient balance, transfer validations, status  
‚úÖ **TransactionRollbackTest** ‚Äî `@Transactional` rollback –ø—Ä–∏ –æ—à–∏–±–∫–µ deposit/withdrawal, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ orphan records

### –ò—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ JaCoCo
- DTO –∫–ª–∞—Å—Å—ã ‚Äî –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã openapi-generator
- API interfaces
- Configuration –∫–ª–∞—Å—Å—ã

### JaCoCo threshold
```
overall:  20% minimum
per-class: 20% minimum (—Å exclusions)
```

---

## üß™ –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### Unit Tests (—Å Mockito)
- –ú–æ–∫–∏—Ä—É—é—Ç—Å—è –≤—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–ë–î, HTTP –∫–ª–∏–µ–Ω—Ç—ã, Kafka)
- –ë—ã—Å—Ç—Ä—ã–µ, –±–µ–∑ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –ü–æ–∫—Ä—ã–≤–∞—é—Ç: PersonApplicationService, PersonMapper, UserService, TokenService, AuthController, FeeCalculator, InitRequestCache, WalletService

### Integration Tests (—Å TestContainers)
- –†–µ–∞–ª—å–Ω–∞—è PostgreSQL –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- –ü–æ–∫—Ä—ã–≤–∞—é—Ç: PersonsApiIT (person-service), TransactionServiceIntegrationTest, TransactionRollbackTest

### Integration Tests (—Å –º–æ–∫–∞–º–∏ HTTP)
- WireMock/MockBean –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö HTTP —Å–µ—Ä–≤–∏—Å–æ–≤
- –ü–æ–∫—Ä—ã–≤–∞—é—Ç: AuthFlowIntegrationTest (individuals-api)

---

## üìã –ö–æ–º–∞–Ω–¥—ã

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
./gradlew test

# –ü–æ –º–æ–¥—É–ª—è–º
./gradlew :person-service:test
./gradlew :individuals-api:test
./gradlew :transaction-service:test

# JaCoCo –æ—Ç—á—ë—Ç—ã (HTML)
./gradlew :person-service:jacocoTestReport
./gradlew :individuals-api:jacocoTestReport
./gradlew :transaction-service:jacocoTestReport

# –û—Ç–∫—Ä—ã—Ç—å –æ—Ç—á—ë—Ç—ã
open person-service/build/reports/jacoco/test/html/index.html
open individuals-api/build/reports/jacoco/test/html/index.html
open transaction-service/build/reports/jacoco/test/html/index.html

# –ü—Ä–æ–≤–µ—Ä–∫–∞ thresholds
./gradlew :person-service:jacocoTestCoverageVerification
./gradlew :individuals-api:jacocoTestCoverageVerification
./gradlew :transaction-service:jacocoTestCoverageVerification
```

---

## ‚úÖ –ò—Ç–æ–≥

- ‚úÖ **88 —Ç–µ—Å—Ç–æ–≤** ‚Äî –≤—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ Unit + Integration —Ç–µ—Å—Ç—ã –ø–æ –≤—Å–µ–º —Ç—Ä—ë–º —Å–µ—Ä–≤–∏—Å–∞–º
- ‚úÖ TestContainers (PostgreSQL) –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- ‚úÖ `@Transactional` rollback —Ç–µ—Å—Ç—ã –¥–ª—è transaction-service
- ‚úÖ JaCoCo thresholds –ø—Ä–æ–π–¥–µ–Ω—ã –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö
- ‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ **80-90%** (–ø–æ—Å–ª–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è autogenerated –∫–æ–¥–∞)