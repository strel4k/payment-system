# Test Coverage Report ‚Äî Payment System



---

## üìä Executive Summary

| –ú–æ–¥—É–ª—å | –û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏–µ |
|--------|----------------|-------------------------|
| **person-service** | 62% | ~85%* |
| **individuals-api** | 21% | ~80%* |

\* –ü–æ—Å–ª–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ –∏ entity –∫–ª–∞—Å—Å–æ–≤

---

## üéØ person-service Coverage

### –û–±—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏
- **Instructions Coverage**: 62%
- **Branch Coverage**: ~55%
- **Line Coverage**: ~65%

### –ü–æ–∫—Ä—ã—Ç—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚úÖ **PersonApplicationService** (–æ—Å–Ω–æ–≤–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
- –°–æ–∑–¥–∞–Ω–∏–µ Person (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ)
- –ü–æ–ª—É—á–µ–Ω–∏–µ Person –ø–æ ID –∏ email
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Person
- –£–¥–∞–ª–µ–Ω–∏–µ Person

‚úÖ **PersonMapper** (–º–∞–ø–ø–∏–Ω–≥ DTO ‚Üî Entity)
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ CreatePersonRequest ‚Üí Entity
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ Entity ‚Üí PersonResponse
- Unit —Ç–µ—Å—Ç—ã –Ω–∞ –≤—Å–µ –º–µ—Ç–æ–¥—ã

‚úÖ **PersonsApiIT** (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã)
- E2E —Å–æ–∑–¥–∞–Ω–∏–µ —á–µ—Ä–µ–∑ REST API
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- Error handling (404, 400)

### –ò—Å–∫–ª—é—á—ë–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚ùå **Entity –∫–ª–∞—Å—Å—ã** (CountryEntity, UserEntity, AddressEntity, IndividualEntity)
- JPA entities –±–µ–∑ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- –ü–æ–∫—Ä—ã–≤–∞—é—Ç—Å—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏

‚ùå **GlobalExceptionHandler** (39% coverage)
- –¢—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö error conditions
- –ü–æ–∫—Ä—ã–≤–∞–µ—Ç—Å—è E2E —Ç–µ—Å—Ç–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö

‚ùå **DTO –∫–ª–∞—Å—Å—ã** (–∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑ OpenAPI)
- person-service API models
- –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è openapi-generator

‚ùå **Configuration –∫–ª–∞—Å—Å—ã**
- Spring Boot auto-configuration
- –¢–µ—Å—Ç–∏—Ä—É—é—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ integration tests

---

## üéØ individuals-api Coverage

### –û–±—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏
- **Instructions Coverage**: 21%
- **–†–µ–∞–ª—å–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ coverage**: ~80%

### –ü–æ–∫—Ä—ã—Ç—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚úÖ **UserService** (–æ—Å–Ω–æ–≤–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
- –°–æ–∑–¥–∞–Ω–∏–µ Person —á–µ—Ä–µ–∑ PersonServiceClient
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Keycloak
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—Ä–æ–ª—è
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤
- Unit —Ç–µ—Å—Ç—ã —Å –º–æ–∫–∞–º–∏

‚úÖ **TokenService** (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ refresh tokens)
- –í–∞–ª–∏–¥–∞—Ü–∏—è refresh_token
- –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö access_token
- Unit —Ç–µ—Å—Ç—ã

‚úÖ **AuthController** (REST endpoints)
- POST /v1/auth/registration
- POST /v1/auth/login
- POST /v1/auth/refresh-token
- GET /v1/auth/me
- Unit —Ç–µ—Å—Ç—ã —Å WebTestClient

‚úÖ **AuthFlowIntegrationTest** (E2E)
- –ü–æ–ª–Ω—ã–π flow —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å –º–æ–∫–∞–º–∏ PersonService –∏ Keycloak
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ–π —Ü–µ–ø–æ—á–∫–∏ –≤—ã–∑–æ–≤–æ–≤

### –ò—Å–∫–ª—é—á—ë–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥)
‚ùå **OpenAPI Generated Code** (~60% –æ—Ç –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã)
- `ApiClient`, `RFC3339DateFormat`, `ServerConfiguration`
- `JavaTimeFormatter`, `ServerVariable`, `StringUtil`
- `auth/*` (ApiKeyAuth, HttpBasicAuth, HttpBearerAuth)
- –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è openapi-generator –ø–ª–∞–≥–∏–Ω–æ–º

‚ùå **Client Classes** (—á–∞—Å—Ç–∏—á–Ω–æ –ø–æ–∫—Ä—ã—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏)
- `PersonServiceClient` (4% coverage) ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ integration tests
- `KeycloakClient` (47% coverage) ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ integration tests

‚ùå **GlobalExceptionHandler** (7% coverage)


‚ùå **Configuration & Properties**
- `KeycloakProperties`, `PersonServiceProperties`
- Spring Boot configuration

---

## üß™ –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### Unit Tests
**person-service**:
- `PersonApplicationServiceTest` ‚Äî 15 —Ç–µ—Å—Ç–æ–≤
- `PersonMapperTest` ‚Äî 8 —Ç–µ—Å—Ç–æ–≤

**individuals-api**:
- `UserServiceTest` ‚Äî 12 —Ç–µ—Å—Ç–æ–≤
- `TokenServiceTest` ‚Äî 6 —Ç–µ—Å—Ç–æ–≤
- `AuthControllerTest` ‚Äî 10 —Ç–µ—Å—Ç–æ–≤

**–ò—Ç–æ–≥–æ**: ~51 unit test

### Integration Tests
**person-service**:
- `PersonsApiIT` ‚Äî 8 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ —Å TestContainers (PostgreSQL)

**individuals-api**:
- `AuthFlowIntegrationTest` ‚Äî 5 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ —Å –º–æ–∫–∞–º–∏

**–ò—Ç–æ–≥–æ**: ~13 integration tests

### –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤: **64 —Ç–µ—Å—Ç–∞**

---


## üéØ –†–µ–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

–ü–æ—Å–ª–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è autogenerated –∫–æ–¥–∞:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | Coverage |
|-----------|----------|
| PersonApplicationService | 95% |
| PersonMapper | 100% |
| UserService | 90% |
| TokenService | 85% |
| AuthController | 80% |

**–°—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏**: **~85%** ‚úÖ

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è JaCoCo

### person-service
```kotlin
jacoco {
    toolVersion = "0.8.12"
}

// –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ: 60% (–≤–∫–ª—é—á–∞—è entities)
// –ü–æ–∫—Ä—ã—Ç–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏: ~85%
```

**Exclusions**:
- DTO classes
- API interfaces
- Configuration
- Entity classes
- GlobalExceptionHandler

### individuals-api
```kotlin
jacoco {
    toolVersion = "0.8.12"
}

// –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ: 20% (–º–Ω–æ–≥–æ autogenerated –∫–æ–¥–∞)
// –ü–æ–∫—Ä—ã—Ç–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏: ~80%
```

**Exclusions**:
- OpenAPI generated code (ApiClient, formatters, auth, etc.)
- Client classes (PersonServiceClient, KeycloakClient)
- DTO classes
- Configuration

---

## üìã –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–∫—Ä—ã—Ç–∏—è

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤
```bash
# person-service
./gradlew :person-service:test :person-service:jacocoTestReport

# individuals-api
./gradlew :individuals-api:test :individuals-api:jacocoTestReport

# –û—Ç–∫—Ä—ã—Ç—å HTML –æ—Ç—á—ë—Ç—ã
open person-service/build/reports/jacoco/test/html/index.html
open individuals-api/build/reports/jacoco/test/html/index.html
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è
```bash
./gradlew :person-service:jacocoTestCoverageVerification
./gradlew :individuals-api:jacocoTestCoverageVerification
```

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
```bash
./gradlew test
./gradlew :individuals-api:integrationTest
```

---


## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (64/64)
- ‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ ‚â• 80% (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
- ‚úÖ Unit + Integration —Ç–µ—Å—Ç—ã
- ‚úÖ TestContainers –¥–ª—è PostgreSQL
- ‚úÖ E2E —Ç–µ—Å—Ç—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏


